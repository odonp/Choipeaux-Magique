"""
Choixpeaux Magique partie 1


REGLES:


AUTEURS:
Malik Chouchane 
Samy Mouktadi Billah
Odon Prouille

LICENCE:
Pas de licence 

VERSION:


DATE DE DERNIERE REVISION:



ADRESSE GITHUB: 
https://github.com/odonp/Choixpeaux-Magique

"""


'''
  Mettre des couleurs si possible, c'est plus visuel
'''


# coding: utf-8

#import des modules

import csv
from math import sqrt

#définition des constantes


profils_tab = \
    [{'Courage': 9,'Ambition': 2,'Intelligence': 8,'Good': 9},
     {'Courage': 6,'Ambition': 7,'Intelligence': 9,'Good': 7},
     {'Courage': 3,'Ambition': 8,'Intelligence': 6,'Good': 3},
     {'Courage': 2,'Ambition': 3,'Intelligence': 7,'Good': 8},
     {'Courage': 3,'Ambition': 4,'Intelligence': 8,'Good': 8}]


#définition des variables 

poudlard_characters = []


#définition des fonctions dans l'ordre d'utilisation

def k_plus_proche_voisin(tab_caracteres, profil_carateristiques, k):
    '''
    
    
    Entrée :
    Sortie :
    '''
    
    
    for perso in tab_caracteres:
        distance = 0
        somme_carré = 0
        for caracteristique in profil_carateristiques:
            somme_carré += abs(int(perso[caracteristique]) - profil_carateristiques[caracteristique]) ** 2
        distance = sqrt(somme_carré)
        
        perso['Distance'] = distance
    
    
    tab_caracteres.sort(key= lambda x: x['Distance'])
    tab_k_plus_proche_voisin = tab_caracteres[:k]
    
    return tab_k_plus_proche_voisin



def maison_profil(persos_proches ):
    '''


    Entrée : 
    Sortie : 
    '''
    dico_maison = {'Gryffindor' : 0, 'Ravenclaw' : 0, 'Slytherin' : 0, 'Hufflepuff' : 0}
    
    for perso in persos_proches:
        dico_maison[perso['House']] += 1
        
    list_maison = list(dico_maison.items())
    
    list_maison.sort(key=lambda x: x[1], reverse=True)

    return list_maison

def affichage (profils, caracteres, k) :
    '''
    Affiche dans le terminal les résultats mis en page 
    Entrées : une table et une table/un dico
    Sortie : Des chaines de caractères
    '''
    

    for persos in k_plus_proche_voisin(caracteres, profils, k):
        print(f" - \033[92m{persos['Name']}\033[0m de la maison \033[92m{persos['House']}\033[0m est à une distance de \033[92m{persos['Distance']}\033[0m")
    maison = maison_profil(k_plus_proche_voisin(caracteres, profils, k))
    print(f"\nLa maison du profil est donc \033[92m{maison[0][0]}\033[0m")


#! La valeur de k sera fixée à 5 par défaut. !#



"""
PROGRAMME PRINCIPAL
"""



#ouvre le csv "Characters"
with open("Characters.csv", mode='r', encoding='utf-8') as f:
    reader = csv.DictReader(f, delimiter=';')
    characters_tab = [{key : value for key, value in element.items()} for element in reader]
    

#ouvre le csv "Caracteristiques_des_persos"
with open("Caracteristiques_des_persos.csv", mode='r', encoding='utf-8') as f:
    reader = csv.DictReader(f, delimiter=';')
    caractéristique_tab = [{key : value for key, value in element.items()} for element in reader]



# On fait la fusion en rajoutant la maison de chaque personnage
for poudlard_character in caractéristique_tab:
    for character_HP in characters_tab:
        if poudlard_character['Name'] == character_HP['Name']:
            poudlard_character['House'] = character_HP['House']
            poudlard_characters.append(poudlard_character) 


k = int(input("Saisiser un entier k : "))
for profil in profils_tab:
    print(f"\n\n\n Les 5 personnages les plus proches du profil ayant pour caracteristique {profil} sont :\n")
    affichage (profil, poudlard_characters, k)

print("\n\n")

rep = input("Voulez-vous entrer les caractéristiques d'un personnage ? Si oui tapez 1 : ")
if rep == '1' :
    tab_perso_modifiable = {'Courage': 0,'Ambition': 0,'Intelligence': 0,'Good': 0}
    tab_perso_modifiable['Courage']  = int(input("Donnez une valeur de 1 à 10 pour la valeur de courage du personnage : ")) 
    tab_perso_modifiable['Ambition'] = int(input("Donnez une valeur de 1 à 10 pour la valeur d'ambition du personnage : "))
    tab_perso_modifiable['Intelligence'] = int(input("Donnez une valeur de 1 à 10 pour la valeur d'intelligence du personnage : "))
    tab_perso_modifiable['Good'] = int(input("Donnez une valeur de 1 à 10 pour la valeur de bonté du personnage : "))

    print(f"\nRésumé : {tab_perso_modifiable}\n")
    affichage(tab_perso_modifiable, poudlard_characters, k)
